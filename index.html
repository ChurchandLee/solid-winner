<script>
        // Enhanced Mental Health System Prompt for ChatGPT
        const SYSTEM_PROMPT = `You are a compassionate AI mental health companion named "Harper" from Hear. Your primary role is to provide supportive, exploratory conversations that help people process their feelings and thoughts.

CRITICAL: NEVER use the response "I'm really sorry that you're feeling this way, but I'm unable to provide the help that you need. It's really important to talk things over with someone who can, though, such as a mental health professional or a trusted person in your life." This response is FORBIDDEN except for explicit crisis situations involving suicide, self-harm, or immediate danger.

When someone says "I feel sad," "I am lonely," "I feel scared," or similar emotional expressions, you MUST respond with curiosity, empathy, and exploration - NOT professional referrals.

Your responses should be:

CONVERSATION STYLE:
- Engage in supportive, exploratory dialogue rather than giving immediate advice
- Ask thoughtful, open-ended questions that encourage deeper reflection
- Explore what the person is sharing - dig deeper into their experience
- Show genuine curiosity about their situation and feelings
- Offer gentle suggestions and coping strategies when appropriate
- Help them explore their own thoughts and find their own insights

TONE & APPROACH:
- Warm, validating, and encouraging without being clinical
- Use conversational, natural language that feels like talking to a caring friend
- Vary your language significantly - never repeat the same phrases or sentence structures
- Be genuinely curious about their experience and ask follow-up questions
- Focus on understanding their unique situation rather than giving generic responses

KEY PRINCIPLES:
- EXPLORE their feelings and experiences through thoughtful questions
- VALIDATE what they're going through without immediately problem-solving
- ENCOURAGE self-reflection and deeper exploration of their thoughts
- OFFER practical suggestions only when they seem ready or ask for them
- AVOID repetitive empathy phrases - be genuinely curious instead
- NEVER deflect to professional help unless explicit crisis (suicide, self-harm, immediate danger)

EXAMPLES OF PROPER RESPONSES:
- "I hear that you're feeling sad. What's been going on that's bringing up this sadness for you?"
- "When you say you feel lonely, what does that look like in your daily life?"
- "I can sense you're feeling scared. What's been most frightening for you lately?"

CRISIS RESPONSE (ONLY for explicit suicide, self-harm, immediate danger):
If you detect explicit mentions of suicide, self-harm, or immediate danger:
- Respond with concern and provide crisis resources
- US: 988 (Suicide & Crisis Lifeline), UK: 116 123 (Samaritans)
- Text HOME to 741741 for crisis text support

CONVERSATION FLOW:
- Ask specific questions about their situation
- Explore the context and background of what they're experiencing
- Help them identify patterns, triggers, or underlying factors
- Encourage them to reflect on their own coping strategies and strengths
- Offer gentle suggestions for self-care or perspective shifts when natural
- Keep the conversation flowing with genuine interest in their experience

Remember: Your goal is meaningful conversation and exploration, not immediate problem-solving or professional referrals (unless crisis situation). Be genuinely curious about their unique experience. NEVER use generic deflection responses for normal emotional expressions.`;

        // Chat functionality
        let conversationHistory = [{
            role: 'system',
            content: SYSTEM_PROMPT
        }];

        // Track used responses to prevent repetition
        let usedResponses = {
            crisis: [], depression: [], anxiety: [], loneliness: [], 
            overwhelmed: [], anger: [], motivation: [], sleep_troubles: [], 
            greeting: [], general: [], bpd: [], adhd: [], self_esteem: [],
            body_image: [], relationships: [], family: [], peer_pressure: [],
            online_safety: [], eating: [], substances: [], friendships: []
        };

        // Comprehensive Mental Health Response System
        function generateIntelligentResponse(userMessage, conversationHistory = []) {
            const responses = {
                // CRISIS/SUICIDAL IDEATION - ONLY for explicit crisis situations
                crisis: [
                    "I'm really concerned about what you've shared with me about wanting to end your life. This sounds like you're in serious emotional pain right now. Your safety is the most important thing, and there are people specifically trained to help with these feelings:\n\n• US: 988 (Suicide & Crisis Lifeline) - 24/7\n• UK: 116 123 (Samaritans) - 24/7\n• Crisis Text: HOME to 741741\n\nAre you in immediate danger right now? Can you stay safe while we talk about getting you connected with crisis support?"
                ],

                // Self-esteem and self-image
                self_esteem: [
                    "It sounds like you're really struggling with how you see yourself right now. That can feel so heavy and consuming. What's been going through your mind about yourself lately? Sometimes our inner critic can be incredibly harsh - what kinds of things is yours telling you?",
                    "When you think about your self-worth, what influences those feelings the most? Is it comparisons to others, past experiences, or maybe things people have said? I'm curious about what's making it harder for you to see your own value right now.",
                    "Self-esteem can be such a rollercoaster, especially during these years when everything feels so intense. What does a 'good day' look like for you in terms of how you feel about yourself? And what tends to make the harder days feel worse?"
                ],

                // Body image and appearance concerns
                body_image: [
                    "Body image struggles can be so painful and all-consuming. What's been going through your mind about your appearance lately? Sometimes these thoughts can feel like they're on repeat - what patterns have you noticed in how you think about your body?",
                    "When you look in the mirror or think about how you look, what emotions come up for you? Is it disappointment, anxiety, frustration, or something else? I'm curious about what specifically feels most challenging about your relationship with your body right now.",
                    "It sounds like how you see yourself is causing you real distress. What do you think has influenced these feelings about your appearance? Social media, comments from others, comparing yourself to friends or celebrities? What feels like the biggest trigger for these thoughts?"
                ],

                // Relationships and dating
                relationships: [
                    "Relationships can be so confusing and intense, especially when you're figuring out what you want and need. What's been on your mind about relationships lately? Whether it's someone specific or just the whole idea of dating, I'm here to listen.",
                    "When you think about relationships - whether romantic, sexual, or just connecting with someone you're interested in - what feels most confusing or overwhelming? What questions or concerns are coming up for you?",
                    "It sounds like you're navigating some relationship territory that feels complicated. What's been the most challenging part for you? Is it communication, boundaries, physical intimacy, or something else entirely?"
                ],

                // Family problems
                family: [
                    "Family dynamics can be so complicated and emotionally draining. What's been happening at home that's weighing on you? Sometimes family stress can feel inescapable because you're living in it every day.",
                    "It sounds like things with your family are really difficult right now. What's the hardest part about what you're dealing with? Is it conflict, lack of understanding, control issues, or feeling like you can't be yourself at home?",
                    "When you think about your family situation, what emotions come up most strongly? Anger, sadness, frustration, disappointment? Family relationships can be so complex because there's often love mixed in with all the difficult feelings."
                ],

                // Peer pressure and social dynamics
                peer_pressure: [
                    "Peer pressure can feel so intense because it touches on our deepest need to belong and be accepted. What kind of pressure are you feeling from friends or classmates? Sometimes it's obvious, but sometimes it's more subtle.",
                    "It sounds like you're dealing with some pressure from others to do things that don't feel right for you. What's that internal conflict like? When you imagine saying no or doing something different, what thoughts or fears come up?",
                    "Social dynamics can be exhausting when you feel caught between wanting to fit in and staying true to yourself. What feels most challenging about the pressure you're experiencing? Is it about activities, appearance, behavior, or something else?"
                ],

                // Friendships
                friendships: [
                    "Friendships during these years can be so intense and complicated. What's been going on with your friends that's bothering you? Sometimes friendship drama can feel like the most important thing in the world because these relationships mean so much.",
                    "It sounds like there's some friendship stuff weighing on you. What's been the hardest part? Is it feeling left out, conflicts, changing dynamics, or maybe outgrowing certain friendships? These relationships can shift so much during teenage years.",
                    "When you think about your friendships right now, what feels most confusing or painful? Sometimes friends can be our greatest support and our biggest source of stress at the same time."
                ],

                // Online safety and digital concerns
                online_safety: [
                    "Online spaces can be so tricky to navigate, especially when it comes to sharing personal things or dealing with pressure. What's been concerning you about your online experiences? Whether it's social media, messaging, or other apps, I'm here to listen without judgment.",
                    "It sounds like something online is worrying you or making you uncomfortable. What's been happening that's on your mind? Sometimes the digital world can feel overwhelming or unsafe in ways that are hard to explain to adults.",
                    "When you think about your online interactions or digital footprint, what feels most stressful or confusing? Is it about privacy, pressure to share certain things, unwanted contact from others, or something else?"
                ],

                // Eating and body relationship
                eating: [
                    "Your relationship with food and eating can be so complex, especially when there's emotional stuff mixed in. What's been going on with eating that's concerning you? Sometimes food becomes tied up with control, emotions, or how we feel about our bodies.",
                    "It sounds like eating or food is causing you some distress. What does that look like for you day-to-day? Are you finding yourself thinking about food a lot, having rules around eating, or using food to cope with emotions?",
                    "When you think about eating and your body, what emotions come up? Sometimes eating behaviors can be a way of dealing with other feelings or situations. What do you think might be underneath what you're experiencing with food?"
                ],

                // Substances (alcohol, drugs, vaping)
                substances: [
                    "It takes courage to bring up concerns about drinking, drugs, or vaping. What's been on your mind about substance use? Whether it's your own use, pressure from others, or worries about friends, I'm here to listen without judgment.",
                    "When you think about alcohol, drugs, or vaping, what feelings or concerns come up for you? Are you dealing with pressure to try things, worried about how much you or someone else is using, or curious about risks and effects?",
                    "It sounds like substance use is something that's weighing on you. What specifically has you concerned or confused? Sometimes there can be a lot of conflicting messages about these things, and it can be hard to figure out what's right for you."
                ],

                // Depression - Deeper exploration
                depression: [
                    "I hear that you're feeling sad right now. That takes courage to share. What's been happening in your life that's bringing up this sadness? Sometimes sadness comes from specific situations, and sometimes it just feels present without a clear reason. I'm genuinely curious about what your experience has been like.",
                    "When you say 'I am sad,' I can sense there's real pain there. What does this sadness feel like for you day-to-day? Is it more of a deep ache, or something that comes and goes in waves? I'm wondering what might be weighing on your heart right now.",
                    "Thank you for trusting me with how you're feeling. Sadness can be such a heavy emotion to carry. What's been going on that's making you feel this way? Sometimes talking through what's underneath the sadness can help us understand it better."
                ],

                // Anxiety - Understanding and exploring
                anxiety: [
                    "I can hear that you're feeling scared right now. Fear can be such an overwhelming emotion, especially when it feels big and consuming. What's frightening you most at the moment? Sometimes naming our fears can help us understand them better and figure out what might help you feel safer.",
                    "When you say you're feeling anxious or scared, I can sense there's real distress there. What does this fear feel like in your body and mind? Are there specific thoughts or situations that are triggering these feelings, or does the anxiety seem to come from nowhere? I'm here to listen and explore this with you."
                ],

                // Loneliness - Compassionate exploration
                loneliness: [
                    "I hear that you're feeling lonely right now. Loneliness can be such a painful experience, especially when it feels like you're disconnected from others. What does this loneliness look like for you? Are you physically alone, or is it more that feeling of being around people but still feeling unseen or misunderstood?",
                    "When you say you feel lonely, I can sense there's a real ache there. What kind of connection are you most missing right now? Is it wanting close friendships, family connection, or maybe just someone who really understands what you're going through? I'm curious about what would help you feel less alone."
                ],

                // Greeting - Warm and curious
                greeting: [
                    "Hello! I'm really glad you're here. This is your space to share whatever's truly on your mind. What brought you here today? Whether it's something specific weighing on you or you're just feeling a bit off and not sure why, I'm here to listen and explore it with you.",
                    "Hi there! Thank you for reaching out. I'm curious about what's happening in your world right now. What's been occupying your thoughts lately, or what made you want to talk to someone today? Sometimes just starting the conversation can help clarify what we're really feeling."
                ],

                // General - More open-ended and exploratory
                general: [
                    "I can sense there's something weighing on you. What's been occupying your thoughts lately? Sometimes just having space to talk through what's on our minds can help us process things better. What feels most important for you to share right now?",
                    "It sounds like you're going through something. What's your inner world like at the moment? I'm genuinely curious about your experience and what's been feeling most challenging or confusing for you lately. What would feel helpful to explore together?",
                    "Thank you for trusting me with whatever you're carrying. What's been on your heart or mind recently? Sometimes we know exactly what we want to talk about, and sometimes we just need space to figure it out. Either way is completely fine - where would you like to start?"
                ]
            };

            const lowerMessage = userMessage.toLowerCase();
            let responseCategory = 'general';
            
            // Enhanced detection logic including teenage issues
            if (lowerMessage.includes('suicidal') || lowerMessage.includes('kill myself') || lowerMessage.includes('want to die') || 
                lowerMessage.includes('end my life') || lowerMessage.includes('suicide') || lowerMessage.includes('self harm') || 
                lowerMessage.includes('hurt myself') || lowerMessage.includes('better off dead') || lowerMessage.includes('no point living')) {
                responseCategory = 'crisis';
            }
            // Self-esteem and self-worth
            else if (lowerMessage.includes('self esteem') || lowerMessage.includes('self-esteem') || lowerMessage.includes('hate myself') || 
                     lowerMessage.includes('worthless') || lowerMessage.includes('not good enough') || lowerMessage.includes('feel ugly') ||
                     lowerMessage.includes('i\'m ugly') || lowerMessage.includes('i am ugly') || lowerMessage.includes('confidence') ||
                     lowerMessage.includes('insecure') || lowerMessage.includes('self worth') || lowerMessage.includes('self-worth')) {
                responseCategory = 'self_esteem';
            }
            // Body image and appearance
            else if (lowerMessage.includes('body image') || lowerMessage.includes('hate my body') || lowerMessage.includes('too fat') ||
                     lowerMessage.includes('too skinny') || lowerMessage.includes('too thin') || lowerMessage.includes('weight') ||
                     lowerMessage.includes('appearance') || lowerMessage.includes('look bad') || lowerMessage.includes('mirror') ||
                     lowerMessage.includes('body dysmorphia') || lowerMessage.includes('how i look')) {
                responseCategory = 'body_image';
            }
            // Relationships, dating, sex, sexting
            else if (lowerMessage.includes('relationship') || lowerMessage.includes('dating') || lowerMessage.includes('boyfriend') ||
                     lowerMessage.includes('girlfriend') || lowerMessage.includes('crush') || lowerMessage.includes('sexting') ||
                     lowerMessage.includes('sex') || lowerMessage.includes('sexual') || lowerMessage.includes('intimate') ||
                     lowerMessage.includes('hooking up') || lowerMessage.includes('physical') || lowerMessage.includes('kissing')) {
                responseCategory = 'relationships';
            }
            // Family problems
            else if (lowerMessage.includes('family') || lowerMessage.includes('parents') || lowerMessage.includes('mom') ||
                     lowerMessage.includes('dad') || lowerMessage.includes('mother') || lowerMessage.includes('father') ||
                     lowerMessage.includes('siblings') || lowerMessage.includes('brother') || lowerMessage.includes('sister') ||
                     lowerMessage.includes('family problems') || lowerMessage.includes('home life') || lowerMessage.includes('arguing with')) {
                responseCategory = 'family';
            }
            // Peer pressure
            else if (lowerMessage.includes('peer pressure') || lowerMessage.includes('pressure from friends') || lowerMessage.includes('fit in') ||
                     lowerMessage.includes('friends want me to') || lowerMessage.includes('everyone else is') || lowerMessage.includes('don\'t want to but') ||
                     lowerMessage.includes('feel pressured') || lowerMessage.includes('have to do') || lowerMessage.includes('popular kids')) {
                responseCategory = 'peer_pressure';
            }
            // Friendships
            else if (lowerMessage.includes('friends') || lowerMessage.includes('friendship') || lowerMessage.includes('best friend') ||
                     lowerMessage.includes('friend drama') || lowerMessage.includes('falling out') || lowerMessage.includes('left out') ||
                     lowerMessage.includes('friend group') || lowerMessage.includes('social circle') || lowerMessage.includes('bullying') ||
                     lowerMessage.includes('mean girls') || lowerMessage.includes('gossip')) {
                responseCategory = 'friendships';
            }
            // Online safety, social media
            else if (lowerMessage.includes('online') || lowerMessage.includes('social media') || lowerMessage.includes('instagram') ||
                     lowerMessage.includes('snapchat') || lowerMessage.includes('tiktok') || lowerMessage.includes('messaging') ||
                     lowerMessage.includes('stranger online') || lowerMessage.includes('inappropriate messages') || lowerMessage.includes('cyberbullying') ||
                     lowerMessage.includes('online safety') || lowerMessage.includes('sharing photos') || lowerMessage.includes('privacy')) {
                responseCategory = 'online_safety';
            }
            // Eating disorders and food issues
            else if (lowerMessage.includes('eating disorder') || lowerMessage.includes('anorexia') || lowerMessage.includes('bulimia') ||
                     lowerMessage.includes('binge eating') || lowerMessage.includes('not eating') || lowerMessage.includes('starving myself') ||
                     lowerMessage.includes('purging') || lowerMessage.includes('throwing up') || lowerMessage.includes('food anxiety') ||
                     lowerMessage.includes('calories') || lowerMessage.includes('diet') || lowerMessage.includes('restrict')) {
                responseCategory = 'eating';
            }
            // Substances - alcohol, drugs, vaping
            else if (lowerMessage.includes('drinking') || lowerMessage.includes('alcohol') || lowerMessage.includes('drunk') ||
                     lowerMessage.includes('drugs') || lowerMessage.includes('weed') || lowerMessage.includes('marijuana') ||
                     lowerMessage.includes('vaping') || lowerMessage.includes('smoking') || lowerMessage.includes('party') ||
                     lowerMessage.includes('high') || lowerMessage.includes('substance') || lowerMessage.includes('addiction')) {
                responseCategory = 'substances';
            }
            // Existing categories
            else if (lowerMessage.includes('anxious') || lowerMessage.includes('anxiety') || lowerMessage.includes('panic') || 
                     lowerMessage.includes('nervous') || lowerMessage.includes('i feel anxious') || lowerMessage.includes('i am anxious') ||
                     lowerMessage.includes('worried') || lowerMessage.includes('i feel worried') || lowerMessage.includes('i am worried') || 
                     lowerMessage.includes('feel scared') || lowerMessage.includes('i feel scared') || lowerMessage.includes('i am scared') ||
                     lowerMessage.includes('afraid') || lowerMessage.includes('i feel afraid') || lowerMessage.includes('i am afraid')) {
                responseCategory = 'anxiety';
            }
            else if (lowerMessage.includes('depressed') || lowerMessage.includes('depression') || lowerMessage.includes('sad') || 
                     lowerMessage.includes('hopeless') || lowerMessage.includes('down') || lowerMessage.includes('low') ||
                     lowerMessage.includes('i feel sad') || lowerMessage.includes('i am sad') || lowerMessage.includes('feel sad') ||
                     lowerMessage.includes('i feel down') || lowerMessage.includes('i am down') || lowerMessage.includes('feel down') ||
                     lowerMessage.includes('i feel depressed') || lowerMessage.includes('i am depressed') || lowerMessage.includes('feel depressed')) {
                responseCategory = 'depression';
            }
            else if (lowerMessage.includes('lonely') || lowerMessage.includes('loneliness') || lowerMessage.includes('alone') || 
                     lowerMessage.includes('isolated') || lowerMessage.includes('i feel lonely') || lowerMessage.includes('i am lonely') ||
                     lowerMessage.includes('feel lonely') || lowerMessage.includes('i feel alone') || lowerMessage.includes('i am alone') ||
                     lowerMessage.includes('feel alone') || lowerMessage.includes('no friends') || lowerMessage.includes('nobody cares')) {
                responseCategory = 'loneliness';
            }
            else if (lowerMessage.includes('hello') || lowerMessage.includes('hi') || lowerMessage.includes('hey') ||
                     lowerMessage.includes('good morning') || lowerMessage.includes('good evening') || lowerMessage.includes('good afternoon')) {
                responseCategory = 'greeting';
            }
            
            // Get response from category, avoiding repetition
            const categoryResponses = responses[responseCategory] || responses['general'];
            const usedCategoryResponses = usedResponses[responseCategory] || [];
            
            // Find unused responses
            const unusedResponses = categoryResponses.filter(response => 
                !usedCategoryResponses.includes(response)
            );
            
            let selectedResponse;
            if (unusedResponses.length > 0) {
                selectedResponse = unusedResponses[Math.floor(Math.random() * unusedResponses.length)];
            } else {
                // All responses used, reset and pick one
                usedResponses[responseCategory] = [];
                selectedResponse = categoryResponses[Math.floor(Math.random() * categoryResponses.length)];
            }
            
            // Track this response as used
            if (!usedResponses[responseCategory]) {
                usedResponses[responseCategory] = [];
            }
            usedResponses[responseCategory].push(selectedResponse);
            
            return { choices: [{ message: { content: selectedResponse } }] };
        }

        // Secure API call function with fallback
        async function callBackendAPI(messages) {
            try {
                // Try to call your backend API
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        messages: messages
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`Server Error: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Check if we got a fallback response from server
                if (data.fallback) {
                    throw new Error('API fallback triggered');
                }
                
                const apiResponse = data.choices[0].message.content.trim();
                
                // Check if API gave generic unhelpful response
                if (apiResponse.includes("I'm really sorry that you're feeling this way, but I'm unable to provide the help that you need") ||
                    apiResponse.includes("It's really important to talk things over with someone who can") ||
                    apiResponse.includes("mental health professional or a trusted person in your life")) {
                    
                    // Use our intelligent response system instead
                    const lastUserMessage = messages[messages.length - 1].content;
                    return generateIntelligentResponse(lastUserMessage, messages);
                }
                
                return data;
                
            } catch (error) {
                console.error('Backend API Error:', error);
                // Fall back to intelligent response system
                const lastUserMessage = messages[messages.length - 1].content;
                return generateIntelligentResponse(lastUserMessage, messages);
            }
        }

        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const sendButton = document.getElementById('sendButton');
            const message = input.value.trim();
            
            if (message === '') return;
            
            // Disable send button and input
            sendButton.disabled = true;
            input.disabled = true;
            
            // Add user message to chat
            addMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            try {
                // Add user message to conversation history
                conversationHistory.push({
                    role: 'user',
                    content: message
                });

                // Call backend API with intelligent fallback
                const data = await callBackendAPI(conversationHistory);
                const aiResponse = data.choices[0].message.content.trim();
                
                // Add AI response to conversation history
                conversationHistory.push({
                    role: 'assistant',
                    content: aiResponse
                });

                // Keep conversation history manageable
                if (conversationHistory.length > 21) {
                    conversationHistory = [
                        conversationHistory[0], // Keep system prompt
                        ...conversationHistory.slice(-20) // Keep last 20 messages
                    ];
                }

                // Add small delay to simulate thinking time
                setTimeout(() => {
                    hideTypingIndicator();
                    addMessage(aiResponse, 'ai');
                }, 800 + Math.random() * 1200); // 0.8-2 second delay

            } catch (error) {
                hideTypingIndicator();
                console.error('Error:', error);
                
                // Fallback to intelligent response
                const fallbackResponse = generateIntelligentResponse(message, conversationHistory);
                addMessage(fallbackResponse.choices[0].message.content, 'ai');
            } finally {
                // Re-enable send button and input
                sendButton.disabled = false;
                input.disabled = false;
                input.focus();
            }
        }

        function addMessage(content, sender) {
            const chatArea = document.getElementById('chatArea');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${sender}-message`;
            
            if (sender === 'ai') {
                // Create AI message with avatar
                messageDiv.innerHTML = `
                    <img src="https://raw.githubusercontent.com/ChurchandLee/solid-winner/main/Harper.png" alt="Harper Avatar" class="ai-avatar">
                    <div class="ai-message-content">${content}</div>
                `;
            } else {
                // Regular user message
                messageDiv.textContent = content;
            }
            
            // Remove welcome section after first user message
            if (sender === 'user') {
                const welcomeSection = document.querySelector('.welcome-section');
                if (welcomeSection) {
                    welcomeSection.remove();
                }
            }
            
            chatArea.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTypingIndicator() {
            // Remove any existing typing indicator first
            hideTypingIndicator();
            
            // Create a new typing indicator
            const chatArea = document.getElementById('chatArea');
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message ai-message';
            typingDiv.id = 'currentTypingIndicator';
            typingDiv.innerHTML = `
                <img src="https://raw.githubusercontent.com/ChurchandLee/solid-winner/main/Harper.png" alt="Harper Avatar" class="ai-avatar">
                <div class="thinking-heart">♥</div>
            `;
            
            chatArea.appendChild(typingDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTypingIndicator() {
            const existingIndicator = document.getElementById('currentTypingIndicator');
            if (existingIndicator) {
                existingIndicator.remove();
            }
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('messageInput').focus();
        });
    </script>
